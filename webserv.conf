# Webserv Configuration File

# Global settings for the server
server {
    # Port to listen on
    listen 8080;
    
    # Server name (can be used to handle different virtual hosts)
    server_name localhost;
    
    # Root directory for serving files
    root /var/www/html;
    
    # Default file to serve if no specific file is requested
    index index.html;

    # Error pages for different status codes
    error_page 404 /errors/404.html;
    error_page 500 /errors/500.html;
    
    # Limit for maximum body size (useful for file uploads)
    client_max_body_size 400000;
    
    # Enable or disable directory listing
    autoindex on;

    # Define routes and their settings
    location / {
        # Default settings for root path
        try_files $uri $uri/ =404;
    }

    # Route for serving static files from a specific directory
    location /static/ {
        alias /var/www/static/;
        autoindex off;
    }

    # Route for handling CGI scripts (e.g., PHP)
    location /cgi-bin/ {
        # Path to the CGI script interpreter
        cgi_pass /usr/bin/php-cgi;
        # Specify allowed methods
        allowed_methods GET POST;
    }

    # Custom route for API requests
    location /api/ {
        root /var/www/api;
        try_files $uri /api/index.php;
        allowed_methods GET POST DELETE;
    }
}

# Additional server (for virtual hosting on another port)
server {
    listen 8081;
    server_name example.com;

    root /var/www/example;
    index index.html;
    
    error_page 403 /errors/403.html;
    error_page 404 /errors/404.html;
}
